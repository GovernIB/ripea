databaseChangeLog:
- property:
    dbms: oracle
    name: varcharUnit
    value: CHAR
- property:
    dbms: postgresql
    name: varcharUnit
    value: ''
- changeSet:
    id: 1693899071612-1
    author: limit
    changes:
    - addColumn:
        tableName: ipa_expedient
        columns:
          - column:
             name: registres_importats
             type: varchar(4000 ${varcharunit})
    - createIndex:
            columns:
            - column:
                name: registres_importats
            indexName: ipa_expedient_reg_importats_i
            tableName: ipa_expedient
    - addColumn:
        tableName: ipa_contingut
        columns:
          - column:
             name: numero_registre
             type: varchar(80 ${varcharunit})
    - sql:
        sql: "update ipa_expedient e
               set e.registres_importats = (
                 select listagg(ep.identificador, ',') within group (order by ep.identificador)
                 from ipa_expedient_peticio ep
                 where ep.expedient_id is not null and ep.expedient_id = e.id 
              );"